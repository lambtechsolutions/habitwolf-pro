     1  <!DOCTYPE html>
     2	<html lang="es">
     3	<head>
     4	    <meta charset="UTF-8">
     5	    <meta name="viewport" content="width=device-width, initial-scale=1.0">
     6	    <title>HabitWolf Pro - Sistema de Autodisciplina Gamificado</title>
     7	    
     8	    <!-- CDN Libraries -->
     9	    <script src="https://cdn.tailwindcss.com"></script>
    10	    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    11	    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    12	    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    13	    
    14	    <style>
    15	        body { 
    16	            font-family: 'Inter', sans-serif; 
    17	            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    18	            min-height: 100vh;
    19	        }
    20	        
    21	        .wolf-card {
    22	            background: linear-gradient(145deg, #2d3748, #4a5568);
    23	            border: 3px solid #4299e1;
    24	            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    25	        }
    26	        
    27	        .wolf-evolution-image {
    28	            width: 120px;
    29	            height: 120px;
    30	            background-image: url('https://cdn1.genspark.ai/user-upload-image/3_generated/242df4d1-d2da-4a97-bba4-f35da853165e');
    31	            background-size: 500% 100%;
    32	            background-repeat: no-repeat;
    33	            background-position: 0% 50%;
    34	            border-radius: 15px;
    35	            border: 3px solid #4299e1;
    36	            transition: all 0.3s ease;
    37	            box-shadow: 0 4px 12px rgba(66, 153, 225, 0.3);
    38	        }
    39	        
    40	        .wolf-evolution-image.level-1 { background-position: 0% 50%; }
    41	        .wolf-evolution-image.level-2 { background-position: 25% 50%; }
    42	        .wolf-evolution-image.level-3 { background-position: 50% 50%; }
    43	        .wolf-evolution-image.level-4 { background-position: 75% 50%; }
    44	        .wolf-evolution-image.level-5 { background-position: 100% 50%; }
    45	        
    46	        .wolf-profile-image {
    47	            width: 180px;
    48	            height: 180px;
    49	            background-image: url('https://cdn1.genspark.ai/user-upload-image/3_generated/242df4d1-d2da-4a97-bba4-f35da853165e');
    50	            background-size: 500% 100%;
    51	            background-repeat: no-repeat;
    52	            background-position: 0% 50%;
    53	            border-radius: 20px;
    54	            border: 4px solid #4299e1;
    55	            margin: 0 auto;
    56	            box-shadow: 0 8px 24px rgba(66, 153, 225, 0.4);
    57	        }
    58	        
    59	        /* Responsive adjustments */
    60	        @media (max-width: 768px) {
    61	            .wolf-evolution-image {
    62	                width: 100px;
    63	                height: 100px;
    64	            }
    65	            
    66	            .wolf-profile-image {
    67	                width: 150px;
    68	                height: 150px;
    69	            }
    70	        }
    71	        
    72	        @media (max-width: 480px) {
    73	            .wolf-evolution-image {
    74	                width: 90px;
    75	                height: 90px;
    76	            }
    77	            
    78	            .wolf-profile-image {
    79	                width: 130px;
    80	                height: 130px;
    81	            }
    82	        }
    83	        
    84	        .habit-card {
    85	            background: linear-gradient(145deg, #e2e8f0, #cbd5e0);
    86	            border-left: 4px solid #4299e1;
    87	        }
    88	        
    89	        .category-card {
    90	            transition: all 0.3s ease;
    91	            cursor: pointer;
    92	        }
    93	        
    94	        .category-card:hover {
    95	            transform: translateY(-2px);
    96	            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    97	        }
    98	        
    99	        .notification {
   100	            position: fixed;
   101	            top: 20px;
   102	            right: 20px;
   103	            z-index: 1000;
   104	            padding: 12px 20px;
   105	            border-radius: 8px;
   106	            color: white;
   107	            font-weight: 500;
   108	            transform: translateX(100%);
   109	            transition: transform 0.3s ease;
   110	            max-width: 300px;
   111	            word-wrap: break-word;
   112	        }
   113	        
   114	        .notification.show {
   115	            transform: translateX(0);
   116	        }
   117	        
   118	        .notification.scrolled {
   119	            position: absolute;
   120	            top: auto;
   121	            transform: translateX(0) !important;
   122	        }
   123	        
   124	        .notification.success {
   125	            background: linear-gradient(135deg, #48bb78, #38a169);
   126	        }
   127	        
   128	        .notification.warning {
   129	            background: linear-gradient(135deg, #ed8936, #dd6b20);
   130	        }
   131	        
   132	        .chart-container {
   133	            height: 300px !important;
   134	        }
   135	        
   136	        .energy-emoji {
   137	            font-size: 1.5rem;
   138	            cursor: pointer;
   139	            transition: all 0.2s ease;
   140	        }
   141	        
   142	        .energy-emoji:hover {
   143	            transform: scale(1.2);
   144	        }
   145	        
   146	        .energy-emoji.selected {
   147	            transform: scale(1.3);
   148	            filter: drop-shadow(0 0 8px rgba(66, 153, 225, 0.6));
   149	        }
   150	        
   151	        .badge {
   152	            background: linear-gradient(145deg, #ffd700, #ffed4e);
   153	            color: #744210;
   154	            border-radius: 20px;
   155	            padding: 4px 12px;
   156	            font-size: 0.8rem;
   157	            font-weight: 600;
   158	        }
   159	        
   160	        .progress-bar {
   161	            background: linear-gradient(90deg, #4299e1, #63b3ed);
   162	            height: 8px;
   163	            border-radius: 4px;
   164	            transition: width 0.5s ease;
   165	        }
   166	    </style>
   167	</head>
   168	<body class="min-h-screen">
   169	    <div id="app" class="container mx-auto px-4 py-6">
   170	        <!-- Header -->
   171	        <header class="text-center mb-8">
   172	            <h1 class="text-4xl font-bold text-white mb-2">üê∫ HabitWolf Pro ‚öîÔ∏è</h1>
   173	            <p class="text-blue-200">Sistema de Autodisciplina Gamificado Avanzado</p>
   174	        </header>
   175	
   176	        <!-- Navigation Tabs -->
   177	        <nav class="flex flex-wrap justify-center gap-2 mb-6">
   178	            <button onclick="showTab('dashboard')" id="tab-dashboard" class="tab-btn bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-all duration-300">
   179	                <i class="fas fa-chart-line mr-2"></i>Dashboard
   180	            </button>
   181	            <button onclick="showTab('daily')" id="tab-daily" class="tab-btn bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition-all duration-300">
   182	                <i class="fas fa-calendar-day mr-2"></i>Registro Diario
   183	            </button>
   184	            <button onclick="showTab('habits')" id="tab-habits" class="tab-btn bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition-all duration-300">
   185	                <i class="fas fa-tasks mr-2"></i>Mis H√°bitos
   186	            </button>
   187	            <button onclick="showTab('analysis')" id="tab-analysis" class="tab-btn bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition-all duration-300">
   188	                <i class="fas fa-brain mr-2"></i>An√°lisis Semanal
   189	            </button>
   190	            <button onclick="showTab('shop')" id="tab-shop" class="tab-btn bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition-all duration-300">
   191	                <i class="fas fa-shopping-cart mr-2"></i>Tienda
   192	            </button>
   193	            <button onclick="showTab('profile')" id="tab-profile" class="tab-btn bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition-all duration-300">
   194	                <i class="fas fa-user mr-2"></i>Mi Lobo
   195	            </button>
   196	        </nav>
   197	
   198	        <!-- Main Content Area -->
   199	        <main id="main-content">
   200	            <!-- Dashboard Tab -->
   201	            <div id="dashboard-tab" class="tab-content">
   202	                <!-- Wolf Status Card -->
   203	                <div class="wolf-card rounded-xl p-6 mb-6 text-white">
   204	                    <div class="flex items-center justify-between mb-4">
   205	                        <div>
   206	                            <h2 class="text-2xl font-bold" id="wolf-name">Cachorro Guerrero</h2>
   207	                            <p class="text-blue-200">Nivel <span id="wolf-level">1</span> ‚Ä¢ <span id="wolf-xp">0</span>/<span id="wolf-max-xp">100</span> XP</p>
   208	                        </div>
   209	                        <div class="wolf-evolution-image level-1" id="wolf-avatar-image"></div>
   210	                    </div>
   211	                    <div class="bg-gray-800 rounded-full h-3 mb-4">
   212	                        <div class="progress-bar h-3 rounded-full" id="xp-bar" style="width: 0%"></div>
   213	                    </div>
   214	                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
   215	                        <div class="text-center">
   216	                            <div class="text-2xl font-bold text-yellow-400" id="total-coins">0</div>
   217	                            <div class="text-sm text-blue-200">ü™ô Monedas</div>
   218	                        </div>
   219	                        <div class="text-center">
   220	                            <div class="text-2xl font-bold text-red-400" id="current-lives">3</div>
   221	                            <div class="text-sm text-blue-200">‚ù§Ô∏è Vidas</div>
   222	                        </div>
   223	                        <div class="text-center">
   224	                            <div class="text-2xl font-bold text-green-400" id="streak-count">0</div>
   225	                            <div class="text-sm text-blue-200">üî• Mejor Racha</div>
   226	                        </div>
   227	                        <div class="text-center">
   228	                            <div class="text-2xl font-bold text-purple-400" id="total-habits">0</div>
   229	                            <div class="text-sm text-blue-200">üìà H√°bitos</div>
   230	                        </div>
   231	                    </div>
   232	                </div>
   233	
   234	                <!-- Weekly Summary Cards -->
   235	                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
   236	                    <div class="bg-white rounded-lg p-4 shadow-lg">
   237	                        <div class="flex items-center justify-between">
   238	                            <div>
   239	                                <p class="text-gray-500 text-sm">H√°bitos Completados</p>
   240	                                <p class="text-2xl font-bold text-green-600" id="weekly-completed">0</p>
   241	                            </div>
   242	                            <i class="fas fa-check-circle text-3xl text-green-500"></i>
   243	                        </div>
   244	                    </div>
   245	                    <div class="bg-white rounded-lg p-4 shadow-lg">
   246	                        <div class="flex items-center justify-between">
   247	                            <div>
   248	                                <p class="text-gray-500 text-sm">Energ√≠a Promedio</p>
   249	                                <p class="text-2xl font-bold text-blue-600" id="weekly-energy">0</p>
   250	                            </div>
   251	                            <i class="fas fa-bolt text-3xl text-blue-500"></i>
   252	                        </div>
   253	                    </div>
   254	                    <div class="bg-white rounded-lg p-4 shadow-lg">
   255	                        <div class="flex items-center justify-between">
   256	                            <div>
   257	                                <p class="text-gray-500 text-sm">D√≠as de Seguimiento</p>
   258	                                <p class="text-2xl font-bold text-purple-600" id="tracking-days">0</p>
   259	                            </div>
   260	                            <i class="fas fa-calendar-check text-3xl text-purple-500"></i>
   261	                        </div>
   262	                    </div>
   263	                    <div class="bg-white rounded-lg p-4 shadow-lg">
   264	                        <div class="flex items-center justify-between">
   265	                            <div>
   266	                                <p class="text-gray-500 text-sm">Bloque M√°s Fuerte</p>
   267	                                <p class="text-xl font-bold text-orange-600" id="strongest-block">-</p>
   268	                            </div>
   269	                            <i class="fas fa-trophy text-3xl text-orange-500"></i>
   270	                        </div>
   271	                    </div>
   272	                </div>
   273	
   274	                <!-- Charts Section -->
   275	                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
   276	                    <!-- Habits Chart -->
   277	                    <div class="bg-white rounded-lg p-4 shadow-lg">
   278	                        <h3 class="text-lg font-semibold mb-4">H√°bitos Completados por D√≠a</h3>
   279	                        <div class="chart-container">
   280	                            <canvas id="habitsChart"></canvas>
   281	                        </div>
   282	                    </div>
   283	                    
   284	                    <!-- Energy Chart -->
   285	                    <div class="bg-white rounded-lg p-4 shadow-lg">
   286	                        <h3 class="text-lg font-semibold mb-4">Nivel de Energ√≠a Diario</h3>
   287	                        <div class="chart-container">
   288	                            <canvas id="energyChart"></canvas>
   289	                        </div>
   290	                    </div>
   291	                </div>
   292	
   293	                <!-- Category Progress with Streaks -->
   294	                <div class="bg-white rounded-lg p-6 shadow-lg mb-6">
   295	                    <h3 class="text-xl font-semibold mb-4">Progreso por Categor√≠a</h3>
   296	                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="category-progress">
   297	                        <!-- Categories will be populated here -->
   298	                    </div>
   299	                </div>
   300	
   301	                <!-- Streaks Dashboard -->
   302	                <div class="bg-white rounded-lg p-6 shadow-lg mb-6">
   303	                    <h3 class="text-xl font-semibold mb-4">üî• Rachas por Categor√≠a</h3>
   304	                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4" id="streaks-display">
   305	                        <!-- Streaks will be populated here -->
   306	                    </div>
   307	                </div>
   308	            </div>
   309	
   310	            <!-- Daily Log Tab -->
   311	            <div id="daily-tab" class="tab-content hidden">
   312	                <div class="bg-white rounded-lg p-6 shadow-lg">
   313	                    <h2 class="text-2xl font-bold mb-6">Registro Diario - <span id="current-date"></span></h2>
   314	                    
   315	                    <!-- Habit Selection -->
   316	                    <div class="mb-6">
   317	                        <h3 class="text-lg font-semibold mb-3">H√°bitos Completados Hoy</h3>
   318	                        <div id="daily-habits" class="space-y-2">
   319	                            <!-- Habits will be populated here -->
   320	                        </div>
   321	                    </div>
   322	
   323	                    <!-- Energy Level -->
   324	                    <div class="mb-6">
   325	                        <h3 class="text-lg font-semibold mb-3">Nivel de Energ√≠a/Enfoque</h3>
   326	                        <div class="flex gap-2" id="energy-selector">
   327	                            <span class="energy-emoji" data-level="1">üò¥</span>
   328	                            <span class="energy-emoji" data-level="2">üòê</span>
   329	                            <span class="energy-emoji" data-level="3">üôÇ</span>
   330	                            <span class="energy-emoji" data-level="4">üòÑ</span>
   331	                            <span class="energy-emoji" data-level="5">üî•</span>
   332	                        </div>
   333	                    </div>
   334	
   335	                    <!-- Daily Reflection -->
   336	                    <div class="mb-6">
   337	                        <h3 class="text-lg font-semibold mb-3">Reflexi√≥n del D√≠a</h3>
   338	                        <textarea id="daily-reflection" class="w-full p-3 border border-gray-300 rounded-lg resize-none" rows="3" placeholder="¬øC√≥mo fue tu d√≠a? ¬øQu√© aprendiste?"></textarea>
   339	                    </div>
   340	
   341	                    <!-- Tomorrow's Intention -->
   342	                    <div class="mb-6">
   343	                        <h3 class="text-lg font-semibold mb-3">Intenci√≥n para Ma√±ana</h3>
   344	                        <textarea id="tomorrow-intention" class="w-full p-3 border border-gray-300 rounded-lg resize-none" rows="2" placeholder="¬øEn qu√© te vas a enfocar ma√±ana?"></textarea>
   345	                    </div>
   346	
   347	                    <!-- Evidence Upload -->
   348	                    <div class="mb-6">
   349	                        <h3 class="text-lg font-semibold mb-3">Evidencia (Imagen)</h3>
   350	                        <input type="file" id="evidence-upload" accept="image/*" class="w-full p-2 border border-gray-300 rounded-lg">
   351	                        <div id="evidence-preview" class="mt-2 hidden">
   352	                            <img id="evidence-image" class="max-w-xs rounded-lg shadow-md" alt="Evidencia">
   353	                        </div>
   354	                    </div>
   355	
   356	                    <!-- Personal Advice Request -->
   357	                    <div class="mb-6">
   358	                        <label class="flex items-center">
   359	                            <input type="checkbox" id="request-advice" class="mr-2">
   360	                            <span class="text-gray-700">Solicitar consejo personalizado</span>
   361	                        </label>
   362	                    </div>
   363	
   364	                    <!-- Save Button -->
   365	                    <button onclick="saveDailyLog()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
   366	                        <i class="fas fa-save mr-2"></i>Guardar Registro Diario
   367	                    </button>
   368	                </div>
   369	            </div>
   370	
   371	            <!-- Habits Tab -->
   372	            <div id="habits-tab" class="tab-content hidden">
   373	                <!-- Add Habit Form -->
   374	                <div class="bg-white rounded-lg p-6 shadow-lg mb-6">
   375	                    <h2 class="text-2xl font-bold mb-4">Gesti√≥n de H√°bitos</h2>
   376	                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
   377	                        <input type="text" id="habit-name" placeholder="Nombre del h√°bito" class="p-3 border border-gray-300 rounded-lg">
   378	                        <select id="habit-category" class="p-3 border border-gray-300 rounded-lg">
   379	                            <option value="">Selecciona categor√≠a</option>
   380	                            <option value="cuerpo">üèÉ‚Äç‚ôÇÔ∏è Cuerpo</option>
   381	                            <option value="mente">üß† Mente</option>
   382	                            <option value="proposito">üéØ Prop√≥sito/Acci√≥n</option>
   383	                            <option value="amor">üíñ Amor y Conexi√≥n</option>
   384	                        </select>
   385	                        <input type="text" id="habit-unit" placeholder="Unidad (ej: minutos)" class="p-3 border border-gray-300 rounded-lg">
   386	                        <input type="number" id="habit-target" placeholder="Meta diaria" class="p-3 border border-gray-300 rounded-lg">
   387	                    </div>
   388	                    <button onclick="addHabit()" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors">
   389	                        <i class="fas fa-plus mr-2"></i>A√±adir H√°bito
   390	                    </button>
   391	                </div>
   392	
   393	                <!-- Habits by Category -->
   394	                <div class="space-y-6" id="habits-by-category">
   395	                    <!-- Categories will be populated here -->
   396	                </div>
   397	
   398	                <!-- Individual Habit Details -->
   399	                <div class="bg-white rounded-lg p-6 shadow-lg">
   400	                    <h3 class="text-xl font-semibold mb-4">Detalle de Progreso Individual</h3>
   401	                    <div id="individual-progress" class="space-y-4">
   402	                        <!-- Individual habit progress will be shown here -->
   403	                    </div>
   404	                </div>
   405	            </div>
   406	
   407	            <!-- Weekly Analysis Tab -->
   408	            <div id="analysis-tab" class="tab-content hidden">
   409	                <div class="bg-white rounded-lg p-6 shadow-lg">
   410	                    <h2 class="text-2xl font-bold mb-6">An√°lisis Semanal</h2>
   411	                    
   412	                    <!-- Week Selector -->
   413	                    <div class="mb-6">
   414	                        <label class="block text-sm font-medium text-gray-700 mb-2">Seleccionar Semana</label>
   415	                        <input type="week" id="week-selector" class="p-2 border border-gray-300 rounded-lg">
   416	                        <button onclick="generateWeeklyAnalysis()" class="ml-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
   417	                            Generar An√°lisis
   418	                        </button>
   419	                    </div>
   420	
   421	                    <!-- Analysis Results -->
   422	                    <div id="weekly-analysis-results" class="space-y-6">
   423	                        <!-- Analysis will be populated here -->
   424	                    </div>
   425	                </div>
   426	            </div>
   427	
   428	            <!-- Shop Tab -->
   429	            <div id="shop-tab" class="tab-content hidden">
   430	                <div class="bg-white rounded-lg p-6 shadow-lg">
   431	                    <h2 class="text-2xl font-bold mb-6">Tienda de Recompensas "Sin Culpa"</h2>
   432	                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="shop-items">
   433	                        <!-- Shop items will be populated here -->
   434	                    </div>
   435	                </div>
   436	            </div>
   437	
   438	            <!-- Profile Tab -->
   439	            <div id="profile-tab" class="tab-content hidden">
   440	                <!-- Data Management Section -->
   441	                <div class="bg-white rounded-lg p-6 shadow-lg mb-6">
   442	                    <h3 class="text-xl font-semibold mb-4">üîê Gesti√≥n de Datos</h3>
   443	                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
   444	                        <button onclick="exportGameData()" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors flex items-center justify-center">
   445	                            <i class="fas fa-download mr-2"></i>Exportar Backup
   446	                        </button>
   447	                        <div class="relative">
   448	                            <input type="file" id="import-file" accept=".json" onchange="importGameData(this)" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
   449	                            <button class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors flex items-center justify-center">
   450	                                <i class="fas fa-upload mr-2"></i>Importar Backup
   451	                            </button>
   452	                        </div>
   453	                        <button onclick="resetGameData()" class="bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors flex items-center justify-center">
   454	                            <i class="fas fa-trash mr-2"></i>Restablecer Todo
   455	                        </button>
   456	                    </div>
   457	                    <div class="mt-4 p-3 bg-blue-50 rounded-lg">
   458	                        <div class="text-sm text-blue-800 space-y-2">
   459	                            <p>
   460	                                <i class="fas fa-save mr-2"></i>
   461	                                <strong>Guardado autom√°tico:</strong> Tus datos se guardan cada 30 segundos y cuando completas acciones.
   462	                            </p>
   463	                            <p>
   464	                                <i class="fas fa-mobile-alt mr-2"></i>
   465	                                <strong>Multiplataforma:</strong> Abre la app en tu tel√©fono, tablet o PC. Tus datos se mantienen en cada dispositivo por separado.
   466	                            </p>
   467	                            <p>
   468	                                <i class="fas fa-cloud mr-2"></i>
   469	                                <strong>Sincronizaci√≥n:</strong> Usa "Exportar/Importar Backup" para transferir datos entre dispositivos.
   470	                            </p>
   471	                            <p>
   472	                                <i class="fas fa-shield-alt mr-2"></i>
   473	                                <strong>Privacidad:</strong> Todos los datos se almacenan localmente en tu dispositivo. Nada se env√≠a a servidores externos.
   474	                            </p>
   475	                        </div>
   476	                    </div>
   477	                </div>
   478	
   479	                <div class="bg-white rounded-lg p-6 shadow-lg">
   480	                    <h2 class="text-2xl font-bold mb-6">Mi Perfil de Lobo Guerrero</h2>
   481	                    
   482	                    <!-- Wolf Evolution Display -->
   483	                    <div class="text-center mb-8">
   484	                        <div class="wolf-profile-image level-1" id="profile-wolf-avatar-image"></div>
   485	                        <h3 class="text-2xl font-bold mt-4" id="profile-wolf-name">Cachorro Guerrero</h3>
   486	                        <p class="text-gray-600">Nivel <span id="profile-wolf-level">1</span></p>
   487	                        <p class="text-sm text-gray-500 mt-2" id="profile-wolf-description">Joven aprendiz con armadura b√°sica de cuero</p>
   488	                    </div>
   489	
   490	                    <!-- Evolution Path -->
   491	                    <div class="mb-8">
   492	                        <h4 class="text-lg font-semibold mb-4">Evoluci√≥n del Guerrero</h4>
   493	                        <div class="grid grid-cols-1 md:grid-cols-5 gap-4" id="evolution-path">
   494	                            <!-- Evolution stages will be shown here -->
   495	                        </div>
   496	                    </div>
   497	
   498	                    <!-- Badges and Achievements -->
   499	                    <div class="mb-8">
   500	                        <h4 class="text-lg font-semibold mb-4">Insignias y Logros</h4>
   501	                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="badges-container">
   502	                            <!-- Badges will be shown here -->
   503	                        </div>
   504	                    </div>
   505	
   506	                    <!-- Statistics -->
   507	                    <div>
   508	                        <h4 class="text-lg font-semibold mb-4">Estad√≠sticas del Guerrero</h4>
   509	                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="profile-stats">
   510	                            <!-- Stats will be shown here -->
   511	                        </div>
   512	                    </div>
   513	                </div>
   514	            </div>
   515	        </main>
   516	    </div>
   517	
   518	    <!-- Notification Container -->
   519	    <div id="notification-container"></div>
   520	
   521	    <script>
   522	        // Global Variables and Data Storage
   523	        let gameData = {
   524	            player: {
   525	                name: 'Cachorro Guerrero',
   526	                level: 1,
   527	                xp: 0,
   528	                maxXp: 100,
   529	                coins: 0,
   530	                lives: 3,
   531	                avatar: 'üêï‚Äçü¶∫'
   532	            },
   533	            habits: [],
   534	            dailyLogs: {},
   535	            categories: {
   536	                cuerpo: { name: 'Cuerpo', icon: 'üèÉ‚Äç‚ôÇÔ∏è', color: 'bg-red-100 text-red-800' },
   537	                mente: { name: 'Mente', icon: 'üß†', color: 'bg-blue-100 text-blue-800' },
   538	                proposito: { name: 'Prop√≥sito/Acci√≥n', icon: 'üéØ', color: 'bg-green-100 text-green-800' },
   539	                amor: { name: 'Amor y Conexi√≥n', icon: 'üíñ', color: 'bg-pink-100 text-pink-800' }
   540	            },
   541	            shopItems: [
   542	                { id: 1, name: 'Episodio de serie favorita', cost: 50, icon: 'üì∫' },
   543	                { id: 2, name: '30 min redes sociales', cost: 30, icon: 'üì±' },
   544	                { id: 3, name: 'Snack especial', cost: 40, icon: 'üçø' },
   545	                { id: 4, name: 'Compra que quer√≠as hacer', cost: 100, icon: 'üõçÔ∏è' },
   546	                { id: 5, name: 'D√≠a de descanso total', cost: 150, icon: 'üõãÔ∏è' }
   547	            ],
   548	            badges: [],
   549	            streaks: {
   550	                cuerpo: 0,
   551	                mente: 0,
   552	                proposito: 0,
   553	                amor: 0
   554	            },
   555	            achievements: {
   556	                firstHabit: false,
   557	                weekWarrior: false,
   558	                energyMaster: false,
   559	                perfectWeek: false,
   560	                streakMaster: false,
   561	                chronicler: false,
   562	                evolution: false,
   563	                coinCollector: false
   564	            },
   565	            wolfEvolution: [
   566	                { level: 1, name: 'Cachorro Guerrero', minXp: 0, avatar: 'üêï‚Äçü¶∫', description: 'Joven aprendiz con armadura b√°sica de cuero' },
   567	                { level: 2, name: 'Lobo Explorador', minXp: 100, avatar: 'ü¶Æ‚öîÔ∏è', description: 'Guerrero novato con espada y armadura de malla' },
   568	                { level: 3, name: 'Guerrero Feroz', minXp: 300, avatar: 'üêï‚Äçü¶∫üõ°Ô∏è', description: 'Veterano de batalla con escudo y armadura de placas' },
   569	                { level: 4, name: 'Comandante Alpha', minXp: 600, avatar: 'ü¶Æüëë', description: 'L√≠der de manada con corona y armadura dorada' },
   570	                { level: 5, name: 'General M√≠stico', minXp: 1000, avatar: 'üêï‚Äçü¶∫‚ú®', description: 'Maestro supremo con armadura encantada y poderes m√°gicos' }
   571	            ]
   572	        };
   573	
   574	        // Initialize App
   575	        document.addEventListener('DOMContentLoaded', function() {
   576	            loadGameData();
   577	            initializeDateSelector();
   578	            showTab('dashboard');
   579	            updateUI();
   580	            setupEventListeners();
   581	        });
   582	
   583	        // Data Management Functions
   584	        function saveGameData() {
   585	            try {
   586	                // Save to localStorage
   587	                localStorage.setItem('habitwolf_pro_data', JSON.stringify(gameData));
   588	                
   589	                // Save backup with timestamp
   590	                const backup = {
   591	                    data: gameData,
   592	                    timestamp: Date.now(),
   593	                    version: '1.0',
   594	                    device: getDeviceInfo()
   595	                };
   596	                localStorage.setItem('habitwolf_pro_backup', JSON.stringify(backup));
   597	                
   598	                // Visual confirmation
   599	                showSaveConfirmation();
   600	                
   601	                console.log('‚úÖ Datos guardados exitosamente');
   602	            } catch (error) {
   603	                console.error('‚ùå Error guardando datos:', error);
   604	                showNotification('Error al guardar. Verifica el espacio de almacenamiento.', 'warning');
   605	            }
   606	        }
   607	
   608	        function loadGameData() {
   609	            try {
   610	                const saved = localStorage.getItem('habitwolf_pro_data');
   611	                if (saved) {
   612	                    const parsedData = JSON.parse(saved);
   613	                    gameData = { ...gameData, ...parsedData };
   614	                    
   615	                    // Validate data integrity
   616	                    validateGameData();
   617	                    
   618	                    console.log('‚úÖ Datos cargados exitosamente');
   619	                    showNotification('¬°Bienvenido de vuelta, guerrero! üê∫', 'success');
   620	                } else {
   621	                    console.log('üÜï Primera vez jugando. Creando datos nuevos...');
   622	                }
   623	            } catch (error) {
   624	                console.error('‚ùå Error cargando datos:', error);
   625	                showNotification('Error al cargar datos. Se crear√° un nuevo perfil.', 'warning');
   626	            }
   627	        }
   628	
   629	        function validateGameData() {
   630	            // Ensure required properties exist
   631	            if (!gameData.player) gameData.player = { name: 'Cachorro Guerrero', level: 1, xp: 0, maxXp: 100, coins: 0, lives: 3, avatar: 'üêï‚Äçü¶∫' };
   632	            if (!gameData.habits) gameData.habits = [];
   633	            if (!gameData.dailyLogs) gameData.dailyLogs = {};
   634	            if (!gameData.badges) gameData.badges = [];
   635	            if (!gameData.streaks) gameData.streaks = { cuerpo: 0, mente: 0, proposito: 0, amor: 0 };
   636	            if (!gameData.achievements) gameData.achievements = {};
   637	        }
   638	
   639	        function exportGameData() {
   640	            try {
   641	                const exportData = {
   642	                    data: gameData,
   643	                    exportDate: new Date().toISOString(),
   644	                    version: '1.0',
   645	                    playerName: gameData.player.name,
   646	                    level: gameData.player.level
   647	                };
   648	                
   649	                const dataStr = JSON.stringify(exportData, null, 2);
   650	                const dataBlob = new Blob([dataStr], { type: 'application/json' });
   651	                const url = URL.createObjectURL(dataBlob);
   652	                
   653	                const link = document.createElement('a');
   654	                link.href = url;
   655	                link.download = `habitwolf_backup_${new Date().toISOString().split('T')[0]}.json`;
   656	                link.click();
   657	                
   658	                URL.revokeObjectURL(url);
   659	                showNotification('¬°Backup exportado exitosamente!', 'success');
   660	            } catch (error) {
   661	                console.error('Error exportando:', error);
   662	                showNotification('Error al exportar datos', 'warning');
   663	            }
   664	        }
   665	
   666	        function importGameData(fileInput) {
   667	            const file = fileInput.files[0];
   668	            if (!file) return;
   669	            
   670	            const reader = new FileReader();
   671	            reader.onload = function(e) {
   672	                try {
   673	                    const importedData = JSON.parse(e.target.result);
   674	                    
   675	                    if (importedData.data && importedData.version) {
   676	                        if (confirm('¬øEst√°s seguro de que quieres importar estos datos? Se reemplazar√°n todos tus datos actuales.')) {
   677	                            gameData = importedData.data;
   678	                            validateGameData();
   679	                            saveGameData();
   680	                            location.reload(); // Reload to apply changes
   681	                        }
   682	                    } else {
   683	                        throw new Error('Formato de archivo inv√°lido');
   684	                    }
   685	                } catch (error) {
   686	                    console.error('Error importando:', error);
   687	                    showNotification('Error: Archivo de backup inv√°lido', 'warning');
   688	                }
   689	            };
   690	            reader.readAsText(file);
   691	        }
   692	
   693	        function resetGameData() {
   694	            if (confirm('‚ö†Ô∏è ¬øEST√ÅS SEGURO? Esto borrar√° TODO tu progreso de manera PERMANENTE. Esta acci√≥n NO se puede deshacer.')) {
   695	                if (confirm('üö® √öLTIMA ADVERTENCIA: Se perder√°n todos tus h√°bitos, estad√≠sticas, logros y progreso. ¬øContinuar?')) {
   696	                    localStorage.removeItem('habitwolf_pro_data');
   697	                    localStorage.removeItem('habitwolf_pro_backup');
   698	                    location.reload();
   699	                }
   700	            }
   701	        }
   702	
   703	        function getDeviceInfo() {
   704	            return {
   705	                userAgent: navigator.userAgent,
   706	                platform: navigator.platform,
   707	                language: navigator.language,
   708	                screenWidth: window.screen.width,
   709	                screenHeight: window.screen.height
   710	            };
   711	        }
   712	
   713	        function showSaveConfirmation() {
   714	            // Small visual indicator that data was saved
   715	            const indicator = document.createElement('div');
   716	            indicator.innerHTML = 'üíæ';
   717	            indicator.className = 'fixed top-4 left-4 text-2xl opacity-0 transition-opacity duration-300 z-50';
   718	            document.body.appendChild(indicator);
   719	            
   720	            setTimeout(() => indicator.style.opacity = '1', 100);
   721	            setTimeout(() => {
   722	                indicator.style.opacity = '0';
   723	                setTimeout(() => document.body.removeChild(indicator), 300);
   724	            }, 1500);
   725	        }
   726	
   727	        // Auto-save every 30 seconds
   728	        setInterval(saveGameData, 30000);
   729	
   730	        // UI Management Functions
   731	        function showTab(tabName) {
   732	            // Hide all tabs
   733	            document.querySelectorAll('.tab-content').forEach(tab => {
   734	                tab.classList.add('hidden');
   735	            });
   736	            
   737	            // Remove active class from all buttons
   738	            document.querySelectorAll('.tab-btn').forEach(btn => {
   739	                btn.classList.remove('bg-blue-600');
   740	                btn.classList.add('bg-gray-600');
   741	            });
   742	            
   743	            // Show selected tab
   744	            document.getElementById(tabName + '-tab').classList.remove('hidden');
   745	            document.getElementById('tab-' + tabName).classList.remove('bg-gray-600');
   746	            document.getElementById('tab-' + tabName).classList.add('bg-blue-600');
   747	            
   748	            // Update content based on tab
   749	            switch(tabName) {
   750	                case 'dashboard':
   751	                    updateDashboard();
   752	                    break;
   753	                case 'daily':
   754	                    updateDailyTab();
   755	                    break;
   756	                case 'habits':
   757	                    updateHabitsTab();
   758	                    break;
   759	                case 'analysis':
   760	                    updateAnalysisTab();
   761	                    break;
   762	                case 'shop':
   763	                    updateShopTab();
   764	                    break;
   765	                case 'profile':
   766	                    updateProfileTab();
   767	                    break;
   768	            }
   769	        }
   770	
   771	        function updateUI() {
   772	            updatePlayerStats();
   773	            updateWolfEvolution();
   774	        }
   775	
   776	        function updatePlayerStats() {
   777	            document.getElementById('wolf-name').textContent = gameData.player.name;
   778	            document.getElementById('wolf-level').textContent = gameData.player.level;
   779	            document.getElementById('wolf-xp').textContent = gameData.player.xp;
   780	            document.getElementById('wolf-max-xp').textContent = gameData.player.maxXp;
   781	            // Update wolf avatar image
   782	            const wolfAvatarImage = document.getElementById('wolf-avatar-image');
   783	            if (wolfAvatarImage) {
   784	                wolfAvatarImage.className = `wolf-evolution-image level-${gameData.player.level}`;
   785	            }
   786	            document.getElementById('total-coins').textContent = gameData.player.coins;
   787	            document.getElementById('current-lives').textContent = gameData.player.lives;
   788	            document.getElementById('total-habits').textContent = gameData.habits.length;
   789	            
   790	            // Update streak display
   791	            const maxStreak = Math.max(...Object.values(gameData.streaks), 0);
   792	            document.getElementById('streak-count').textContent = maxStreak;
   793	            
   794	            // Update XP bar
   795	            const xpPercentage = (gameData.player.xp / gameData.player.maxXp) * 100;
   796	            document.getElementById('xp-bar').style.width = xpPercentage + '%';
   797	        }
   798	
   799	        function updateWolfEvolution() {
   800	            const currentEvolution = gameData.wolfEvolution.find(evo => 
   801	                gameData.player.xp >= evo.minXp && 
   802	                (gameData.wolfEvolution[evo.level] ? gameData.player.xp < gameData.wolfEvolution[evo.level].minXp : true)
   803	            );
   804	            
   805	            if (currentEvolution && currentEvolution.level !== gameData.player.level) {
   806	                gameData.player.level = currentEvolution.level;
   807	                gameData.player.name = currentEvolution.name;
   808	                gameData.player.avatar = currentEvolution.avatar;
   809	                
   810	                showNotification(`¬°Evoluci√≥n! Ahora eres ${currentEvolution.name}!`, 'success');
   811	                
   812	                if (currentEvolution.level < gameData.wolfEvolution.length) {
   813	                    gameData.player.maxXp = gameData.wolfEvolution[currentEvolution.level].minXp;
   814	                }
   815	                
   816	                saveGameData();
   817	            }
   818	        }
   819	
   820	        // Habit Management Functions
   821	        function addHabit() {
   822	            const name = document.getElementById('habit-name').value.trim();
   823	            const category = document.getElementById('habit-category').value;
   824	            const unit = document.getElementById('habit-unit').value.trim();
   825	            const target = parseInt(document.getElementById('habit-target').value);
   826	
   827	            if (!name || !category || !unit || !target) {
   828	                showNotification('Por favor completa todos los campos', 'warning');
   829	                return;
   830	            }
   831	
   832	            const habit = {
   833	                id: Date.now(),
   834	                name,
   835	                category,
   836	                unit,
   837	                target,
   838	                completed: {},
   839	                streak: 0,
   840	                totalCompleted: 0
   841	            };
   842	
   843	            gameData.habits.push(habit);
   844	            saveGameData();
   845	            updateHabitsTab();
   846	            
   847	            // Clear form
   848	            document.getElementById('habit-name').value = '';
   849	            document.getElementById('habit-category').value = '';
   850	            document.getElementById('habit-unit').value = '';
   851	            document.getElementById('habit-target').value = '';
   852	            
   853	            showNotification('¬°H√°bito a√±adido correctamente!', 'success');
   854	        }
   855	
   856	        function deleteHabit(habitId) {
   857	            if (confirm('¬øEst√°s seguro de que quieres eliminar este h√°bito?')) {
   858	                gameData.habits = gameData.habits.filter(h => h.id !== habitId);
   859	                saveGameData();
   860	                updateHabitsTab();
   861	                showNotification('H√°bito eliminado', 'success');
   862	            }
   863	        }
   864	
   865	        // Daily Log Functions
   866	        function initializeDateSelector() {
   867	            const today = new Date().toISOString().split('T')[0];
   868	            document.getElementById('current-date').textContent = formatDate(today);
   869	            
   870	            const weekSelector = document.getElementById('week-selector');
   871	            weekSelector.value = getISOWeek(new Date());
   872	        }
   873	
   874	        function updateDailyTab() {
   875	            const today = new Date().toISOString().split('T')[0];
   876	            const dailyHabitsContainer = document.getElementById('daily-habits');
   877	            
   878	            dailyHabitsContainer.innerHTML = '';
   879	            
   880	            if (gameData.habits.length === 0) {
   881	                dailyHabitsContainer.innerHTML = '<p class="text-gray-500">No tienes h√°bitos configurados. Ve a la pesta√±a "Mis H√°bitos" para a√±adir algunos.</p>';
   882	                return;
   883	            }
   884	            
   885	            gameData.habits.forEach(habit => {
   886	                const isCompleted = gameData.dailyLogs[today]?.habits?.includes(habit.id);
   887	                const habitElement = document.createElement('label');
   888	                habitElement.className = 'flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer';
   889	                habitElement.innerHTML = `
   890	                    <input type="checkbox" ${isCompleted ? 'checked' : ''} onchange="toggleHabitCompletion(${habit.id})" class="mr-3">
   891	                    <div class="flex-1">
   892	                        <div class="font-medium">${habit.name}</div>
   893	                        <div class="text-sm text-gray-500">${gameData.categories[habit.category].icon} ${gameData.categories[habit.category].name} ‚Ä¢ Meta: ${habit.target} ${habit.unit}</div>
   894	                    </div>
   895	                `;
   896	                dailyHabitsContainer.appendChild(habitElement);
   897	            });
   898	            
   899	            // Load existing daily log data
   900	            loadDailyLogData(today);
   901	        }
   902	
   903	        function loadDailyLogData(date) {
   904	            const log = gameData.dailyLogs[date];
   905	            if (log) {
   906	                // Set energy level
   907	                if (log.energyLevel) {
   908	                    document.querySelectorAll('.energy-emoji').forEach(emoji => {
   909	                        emoji.classList.remove('selected');
   910	                    });
   911	                    document.querySelector(`[data-level="${log.energyLevel}"]`).classList.add('selected');
   912	                }
   913	                
   914	                // Set reflection and intention
   915	                document.getElementById('daily-reflection').value = log.reflection || '';
   916	                document.getElementById('tomorrow-intention').value = log.intention || '';
   917	                document.getElementById('request-advice').checked = log.requestAdvice || false;
   918	                
   919	                // Set evidence image
   920	                if (log.evidenceImage) {
   921	                    document.getElementById('evidence-image').src = log.evidenceImage;
   922	                    document.getElementById('evidence-preview').classList.remove('hidden');
   923	                }
   924	            }
   925	        }
   926	
   927	        function toggleHabitCompletion(habitId) {
   928	            const today = new Date().toISOString().split('T')[0];
   929	            
   930	            if (!gameData.dailyLogs[today]) {
   931	                gameData.dailyLogs[today] = { habits: [] };
   932	            }
   933	            
   934	            const habits = gameData.dailyLogs[today].habits || [];
   935	            const index = habits.indexOf(habitId);
   936	            const habit = gameData.habits.find(h => h.id === habitId);
   937	            
   938	            if (index === -1) {
   939	                habits.push(habitId);
   940	                // Award XP and coins
   941	                gameData.player.xp += 10;
   942	                gameData.player.coins += 5;
   943	                
   944	                // Update streaks
   945	                updateStreaks();
   946	                
   947	                // Check for achievements
   948	                checkAchievements();
   949	                
   950	                showNotification('¬°H√°bito completado! +10 XP, +5 monedas', 'success');
   951	            } else {
   952	                habits.splice(index, 1);
   953	                gameData.player.xp = Math.max(0, gameData.player.xp - 10);
   954	                gameData.player.coins = Math.max(0, gameData.player.coins - 5);
   955	                
   956	                // Update streaks (might break them)
   957	                updateStreaks();
   958	            }
   959	            
   960	            gameData.dailyLogs[today].habits = habits;
   961	            saveGameData();
   962	            updateWolfEvolution();
   963	            updatePlayerStats();
   964	        }
   965	
   966	        function saveDailyLog() {
   967	            const today = new Date().toISOString().split('T')[0];
   968	            
   969	            if (!gameData.dailyLogs[today]) {
   970	                gameData.dailyLogs[today] = { habits: [] };
   971	            }
   972	            
   973	            // Get energy level
   974	            const selectedEnergy = document.querySelector('.energy-emoji.selected');
   975	            if (selectedEnergy) {
   976	                gameData.dailyLogs[today].energyLevel = parseInt(selectedEnergy.dataset.level);
   977	            }
   978	            
   979	            // Get reflection and intention
   980	            gameData.dailyLogs[today].reflection = document.getElementById('daily-reflection').value;
   981	            gameData.dailyLogs[today].intention = document.getElementById('tomorrow-intention').value;
   982	            gameData.dailyLogs[today].requestAdvice = document.getElementById('request-advice').checked;
   983	            
   984	            // Handle evidence image
   985	            const evidenceFile = document.getElementById('evidence-upload').files[0];
   986	            if (evidenceFile) {
   987	                const reader = new FileReader();
   988	                reader.onload = function(e) {
   989	                    gameData.dailyLogs[today].evidenceImage = e.target.result;
   990	                    saveGameData();
   991	                };
   992	                reader.readAsDataURL(evidenceFile);
   993	            }
   994	            
   995	            gameData.dailyLogs[today].timestamp = Date.now();
   996	            
   997	            saveGameData();
   998	            showNotification('¬°Registro diario guardado exitosamente!', 'success');
   999	            
  1000	            // Award completion bonus
  1001	            gameData.player.xp += 5;
  1002	            gameData.player.coins += 2;
  1003	            updateWolfEvolution();
  1004	            updatePlayerStats();
  1005	        }
  1006	
  1007	        // Dashboard Functions
  1008	        function updateDashboard() {
  1009	            updateWeeklySummary();
  1010	            updateCharts();
  1011	            updateCategoryProgress();
  1012	            updateStreaksDisplay();
  1013	        }
  1014	
  1015	        function updateWeeklySummary() {
  1016	            const weekData = getWeekData();
  1017	            
  1018	            document.getElementById('weekly-completed').textContent = weekData.totalCompleted;
  1019	            document.getElementById('weekly-energy').textContent = weekData.avgEnergy.toFixed(1);
  1020	            document.getElementById('tracking-days').textContent = weekData.trackingDays;
  1021	            document.getElementById('strongest-block').textContent = weekData.strongestBlock || '-';
  1022	        }
  1023	
  1024	        function updateCharts() {
  1025	            updateHabitsChart();
  1026	            updateEnergyChart();
  1027	        }
  1028	
  1029	        function updateHabitsChart() {
  1030	            const ctx = document.getElementById('habitsChart');
  1031	            if (!ctx) return;
  1032	            
  1033	            const weekData = getWeekData();
  1034	            
  1035	            new Chart(ctx, {
  1036	                type: 'bar',
  1037	                data: {
  1038	                    labels: ['Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b', 'Dom'],
  1039	                    datasets: [{
  1040	                        label: 'H√°bitos Completados',
  1041	                        data: weekData.dailyHabits,
  1042	                        backgroundColor: '#4299e1',
  1043	                        borderColor: '#3182ce',
  1044	                        borderWidth: 1
  1045	                    }]
  1046	                },
  1047	                options: {
  1048	                    responsive: true,
  1049	                    maintainAspectRatio: false,
  1050	                    scales: {
  1051	                        y: {
  1052	                            beginAtZero: true
  1053	                        }
  1054	                    }
  1055	                }
  1056	            });
  1057	        }
  1058	
  1059	        function updateEnergyChart() {
  1060	            const ctx = document.getElementById('energyChart');
  1061	            if (!ctx) return;
  1062	            
  1063	            const weekData = getWeekData();
  1064	            
  1065	            new Chart(ctx, {
  1066	                type: 'line',
  1067	                data: {
  1068	                    labels: ['Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b', 'Dom'],
  1069	                    datasets: [{
  1070	                        label: 'Nivel de Energ√≠a',
  1071	                        data: weekData.dailyEnergy,
  1072	                        borderColor: '#48bb78',
  1073	                        backgroundColor: 'rgba(72, 187, 120, 0.1)',
  1074	                        tension: 0.4
  1075	                    }]
  1076	                },
  1077	                options: {
  1078	                    responsive: true,
  1079	                    maintainAspectRatio: false,
  1080	                    scales: {
  1081	                        y: {
  1082	                            beginAtZero: true,
  1083	                            max: 5
  1084	                        }
  1085	                    }
  1086	                }
  1087	            });
  1088	        }
  1089	
  1090	        function updateCategoryProgress() {
  1091	            const container = document.getElementById('category-progress');
  1092	            container.innerHTML = '';
  1093	            
  1094	            Object.keys(gameData.categories).forEach(catKey => {
  1095	                const category = gameData.categories[catKey];
  1096	                const categoryHabits = gameData.habits.filter(h => h.category === catKey);
  1097	                const weekData = getCategoryWeekData(catKey);
  1098	                
  1099	                const streak = gameData.streaks[catKey] || 0;
  1100	                const categoryElement = document.createElement('div');
  1101	                categoryElement.className = 'p-4 border border-gray-200 rounded-lg';
  1102	                categoryElement.innerHTML = `
  1103	                    <div class="flex items-center justify-between mb-2">
  1104	                        <span class="${category.color} px-2 py-1 rounded-full text-sm font-medium">
  1105	                            ${category.icon} ${category.name}
  1106	                        </span>
  1107	                        <div class="text-right">
  1108	                            <span class="text-lg font-bold">${weekData.percentage}%</span>
  1109	                            ${streak > 0 ? `<div class="text-xs text-orange-600">üî• ${streak} d√≠as</div>` : ''}
  1110	                        </div>
  1111	                    </div>
  1112	                    <div class="bg-gray-200 rounded-full h-2">
  1113	                        <div class="progress-bar h-2 rounded-full" style="width: ${weekData.percentage}%"></div>
  1114	                    </div>
  1115	                    <div class="text-sm text-gray-600 mt-2">
  1116	                        ${weekData.completed}/${weekData.total} h√°bitos completados
  1117	                    </div>
  1118	                `;
  1119	                container.appendChild(categoryElement);
  1120	            });
  1121	        }
  1122	
  1123	        // Utility Functions
  1124	        function getWeekData() {
  1125	            const now = new Date();
  1126	            const weekStart = new Date(now.setDate(now.getDate() - now.getDay() + 1));
  1127	            const weekData = {
  1128	                totalCompleted: 0,
  1129	                avgEnergy: 0,
  1130	                trackingDays: 0,
  1131	                strongestBlock: '',
  1132	                dailyHabits: [0,0,0,0,0,0,0],
  1133	                dailyEnergy: [0,0,0,0,0,0,0]
  1134	            };
  1135	            
  1136	            let totalEnergy = 0;
  1137	            let energyDays = 0;
  1138	            const blockScores = {};
  1139	            
  1140	            for (let i = 0; i < 7; i++) {
  1141	                const date = new Date(weekStart);
  1142	                date.setDate(date.getDate() + i);
  1143	                const dateStr = date.toISOString().split('T')[0];
  1144	                const dayLog = gameData.dailyLogs[dateStr];
  1145	                
  1146	                if (dayLog) {
  1147	                    weekData.trackingDays++;
  1148	                    weekData.totalCompleted += dayLog.habits ? dayLog.habits.length : 0;
  1149	                    weekData.dailyHabits[i] = dayLog.habits ? dayLog.habits.length : 0;
  1150	                    
  1151	                    if (dayLog.energyLevel) {
  1152	                        totalEnergy += dayLog.energyLevel;
  1153	                        energyDays++;
  1154	                        weekData.dailyEnergy[i] = dayLog.energyLevel;
  1155	                    }
  1156	                    
  1157	                    // Calculate block scores
  1158	                    if (dayLog.habits) {
  1159	                        dayLog.habits.forEach(habitId => {
  1160	                            const habit = gameData.habits.find(h => h.id === habitId);
  1161	                            if (habit) {
  1162	                                blockScores[habit.category] = (blockScores[habit.category] || 0) + 1;
  1163	                            }
  1164	                        });
  1165	                    }
  1166	                }
  1167	            }
  1168	            
  1169	            weekData.avgEnergy = energyDays > 0 ? totalEnergy / energyDays : 0;
  1170	            
  1171	            // Find strongest block
  1172	            let maxScore = 0;
  1173	            Object.keys(blockScores).forEach(block => {
  1174	                if (blockScores[block] > maxScore) {
  1175	                    maxScore = blockScores[block];
  1176	                    weekData.strongestBlock = gameData.categories[block].name;
  1177	                }
  1178	            });
  1179	            
  1180	            return weekData;
  1181	        }
  1182	
  1183	        function getCategoryWeekData(category) {
  1184	            const categoryHabits = gameData.habits.filter(h => h.category === category);
  1185	            const now = new Date();
  1186	            const weekStart = new Date(now.setDate(now.getDate() - now.getDay() + 1));
  1187	            
  1188	            let completed = 0;
  1189	            let total = 0;
  1190	            
  1191	            for (let i = 0; i < 7; i++) {
  1192	                const date = new Date(weekStart);
  1193	                date.setDate(date.getDate() + i);
  1194	                const dateStr = date.toISOString().split('T')[0];
  1195	                const dayLog = gameData.dailyLogs[dateStr];
  1196	                
  1197	                total += categoryHabits.length;
  1198	                
  1199	                if (dayLog && dayLog.habits) {
  1200	                    categoryHabits.forEach(habit => {
  1201	                        if (dayLog.habits.includes(habit.id)) {
  1202	                            completed++;
  1203	                        }
  1204	                    });
  1205	                }
  1206	            }
  1207	            
  1208	            const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;
  1209	            
  1210	            return { completed, total, percentage };
  1211	        }
  1212	
  1213	        function formatDate(dateStr) {
  1214	            const date = new Date(dateStr);
  1215	            return date.toLocaleDateString('es-ES', { 
  1216	                weekday: 'long', 
  1217	                year: 'numeric', 
  1218	                month: 'long', 
  1219	                day: 'numeric' 
  1220	            });
  1221	        }
  1222	
  1223	        function getISOWeek(date) {
  1224	            const year = date.getFullYear();
  1225	            const week = Math.ceil((((date - new Date(year, 0, 1)) / 86400000) + 1) / 7);
  1226	            return `${year}-W${week.toString().padStart(2, '0')}`;
  1227	        }
  1228	
  1229	        function showNotification(message, type = 'success') {
  1230	            const notification = document.createElement('div');
  1231	            notification.className = `notification ${type}`;
  1232	            notification.textContent = message;
  1233	            
  1234	            // Remove existing notification if any
  1235	            const existingNotification = document.querySelector('.notification');
  1236	            if (existingNotification) {
  1237	                existingNotification.remove();
  1238	            }
  1239	            
  1240	            document.body.appendChild(notification);
  1241	            
  1242	            // Show notification
  1243	            requestAnimationFrame(() => {
  1244	                notification.classList.add('show');
  1245	            });
  1246	            
  1247	            // Auto hide notification
  1248	            setTimeout(() => {
  1249	                if (notification.parentNode) {
  1250	                    notification.classList.remove('show');
  1251	                    setTimeout(() => {
  1252	                        if (notification.parentNode) {
  1253	                            notification.parentNode.removeChild(notification);
  1254	                        }
  1255	                    }, 300);
  1256	                }
  1257	            }, 3000);
  1258	        }
  1259	
  1260	        // Event Listeners Setup
  1261	        function setupEventListeners() {
  1262	            // Energy selector
  1263	            document.querySelectorAll('.energy-emoji').forEach(emoji => {
  1264	                emoji.addEventListener('click', function() {
  1265	                    document.querySelectorAll('.energy-emoji').forEach(e => e.classList.remove('selected'));
  1266	                    this.classList.add('selected');
  1267	                });
  1268	            });
  1269	            
  1270	            // Evidence upload preview
  1271	            document.getElementById('evidence-upload').addEventListener('change', function(e) {
  1272	                const file = e.target.files[0];
  1273	                if (file) {
  1274	                    const reader = new FileReader();
  1275	                    reader.onload = function(e) {
  1276	                        document.getElementById('evidence-image').src = e.target.result;
  1277	                        document.getElementById('evidence-preview').classList.remove('hidden');
  1278	                    };
  1279	                    reader.readAsDataURL(file);
  1280	                }
  1281	            });
  1282	        }
  1283	
  1284	        // Placeholder functions for other tabs
  1285	        function updateHabitsTab() {
  1286	            const container = document.getElementById('habits-by-category');
  1287	            container.innerHTML = '';
  1288	            
  1289	            Object.keys(gameData.categories).forEach(catKey => {
  1290	                const category = gameData.categories[catKey];
  1291	                const categoryHabits = gameData.habits.filter(h => h.category === catKey);
  1292	                
  1293	                if (categoryHabits.length > 0) {
  1294	                    const categorySection = document.createElement('div');
  1295	                    categorySection.className = 'bg-white rounded-lg p-6 shadow-lg';
  1296	                    categorySection.innerHTML = `
  1297	                        <h3 class="text-xl font-semibold mb-4">
  1298	                            ${category.icon} ${category.name}
  1299	                        </h3>
  1300	                        <div class="space-y-3" id="category-${catKey}">
  1301	                            ${categoryHabits.map(habit => `
  1302	                                <div class="habit-card p-4 rounded-lg">
  1303	                                    <div class="flex justify-between items-center">
  1304	                                        <div>
  1305	                                            <h4 class="font-medium">${habit.name}</h4>
  1306	                                            <p class="text-sm text-gray-600">Meta: ${habit.target} ${habit.unit}</p>
  1307	                                        </div>
  1308	                                        <button onclick="deleteHabit(${habit.id})" class="text-red-500 hover:text-red-700">
  1309	                                            <i class="fas fa-trash"></i>
  1310	                                        </button>
  1311	                                    </div>
  1312	                                </div>
  1313	                            `).join('')}
  1314	                        </div>
  1315	                    `;
  1316	                    container.appendChild(categorySection);
  1317	                }
  1318	            });
  1319	            
  1320	            updateIndividualProgress();
  1321	        }
  1322	
  1323	        function updateIndividualProgress() {
  1324	            const container = document.getElementById('individual-progress');
  1325	            container.innerHTML = '';
  1326	            
  1327	            gameData.habits.forEach(habit => {
  1328	                const weekData = getHabitWeekData(habit.id);
  1329	                const progressElement = document.createElement('div');
  1330	                progressElement.className = 'p-4 border border-gray-200 rounded-lg';
  1331	                progressElement.innerHTML = `
  1332	                    <div class="flex justify-between items-center mb-2">
  1333	                        <h4 class="font-medium">${habit.name}</h4>
  1334	                        <span class="text-lg font-bold">${weekData.percentage}%</span>
  1335	                    </div>
  1336	                    <div class="bg-gray-200 rounded-full h-2 mb-2">
  1337	                        <div class="progress-bar h-2 rounded-full" style="width: ${weekData.percentage}%"></div>
  1338	                    </div>
  1339	                    <div class="text-sm text-gray-600">
  1340	                        ${weekData.completed}/7 d√≠as completados esta semana
  1341	                    </div>
  1342	                `;
  1343	                container.appendChild(progressElement);
  1344	            });
  1345	        }
  1346	
  1347	        function getHabitWeekData(habitId) {
  1348	            const now = new Date();
  1349	            const weekStart = new Date(now.setDate(now.getDate() - now.getDay() + 1));
  1350	            
  1351	            let completed = 0;
  1352	            
  1353	            for (let i = 0; i < 7; i++) {
  1354	                const date = new Date(weekStart);
  1355	                date.setDate(date.getDate() + i);
  1356	                const dateStr = date.toISOString().split('T')[0];
  1357	                const dayLog = gameData.dailyLogs[dateStr];
  1358	                
  1359	                if (dayLog && dayLog.habits && dayLog.habits.includes(habitId)) {
  1360	                    completed++;
  1361	                }
  1362	            }
  1363	            
  1364	            const percentage = Math.round((completed / 7) * 100);
  1365	            return { completed, total: 7, percentage };
  1366	        }
  1367	
  1368	        function updateAnalysisTab() {
  1369	            // Set current week as default
  1370	            const weekSelector = document.getElementById('week-selector');
  1371	            if (!weekSelector.value) {
  1372	                weekSelector.value = getISOWeek(new Date());
  1373	            }
  1374	            
  1375	            const container = document.getElementById('weekly-analysis-results');
  1376	            container.innerHTML = '<p class="text-gray-500">Selecciona una semana y genera el an√°lisis para ver los resultados detallados.</p>';
  1377	        }
  1378	
  1379	        function generateWeeklyAnalysis() {
  1380	            const weekSelector = document.getElementById('week-selector');
  1381	            const selectedWeek = weekSelector.value;
  1382	            
  1383	            if (!selectedWeek) {
  1384	                showNotification('Por favor selecciona una semana', 'warning');
  1385	                return;
  1386	            }
  1387	            
  1388	            const analysis = calculateWeeklyAnalysis(selectedWeek);
  1389	            const analysisResults = document.getElementById('weekly-analysis-results');
  1390	            
  1391	            analysisResults.innerHTML = `
  1392	                <!-- Summary Stats -->
  1393	                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
  1394	                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
  1395	                        <h4 class="text-lg font-semibold text-green-800 mb-2">‚úÖ H√°bitos Cumplidos</h4>
  1396	                        <div class="text-3xl font-bold text-green-600">${analysis.habitsCompleted.percentage}%</div>
  1397	                        <div class="text-sm text-green-700">${analysis.habitsCompleted.completed}/${analysis.habitsCompleted.total} h√°bitos</div>
  1398	                    </div>
  1399	                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
  1400	                        <h4 class="text-lg font-semibold text-blue-800 mb-2">‚ö° Energ√≠a Promedio</h4>
  1401	                        <div class="text-3xl font-bold text-blue-600">${analysis.averageEnergy.toFixed(1)}/5</div>
  1402	                        <div class="text-sm text-blue-700">${getEnergyDescription(analysis.averageEnergy)}</div>
  1403	                    </div>
  1404	                    <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
  1405	                        <h4 class="text-lg font-semibold text-purple-800 mb-2">üìä Consistencia</h4>
  1406	                        <div class="text-3xl font-bold text-purple-600">${analysis.consistency}%</div>
  1407	                        <div class="text-sm text-purple-700">${analysis.trackingDays}/7 d√≠as registrados</div>
  1408	                    </div>
  1409	                </div>
  1410	
  1411	                <!-- Strengths and Weaknesses -->
  1412	                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
  1413	                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
  1414	                        <h4 class="text-lg font-semibold text-green-800 mb-3">üí™ √Årea M√°s Fuerte</h4>
  1415	                        <div class="text-xl font-bold text-green-700 mb-2">${analysis.strongestArea.name}</div>
  1416	                        <div class="text-green-600">${analysis.strongestArea.score}% de cumplimiento</div>
  1417	                        <div class="text-sm text-green-700 mt-2">${analysis.strongestArea.feedback}</div>
  1418	                    </div>
  1419	                    <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">
  1420	                        <h4 class="text-lg font-semibold text-orange-800 mb-3">üéØ √Årea de Oportunidad</h4>
  1421	                        <div class="text-xl font-bold text-orange-700 mb-2">${analysis.weakestArea.name}</div>
  1422	                        <div class="text-orange-600">${analysis.weakestArea.score}% de cumplimiento</div>
  1423	                        <div class="text-sm text-orange-700 mt-2">${analysis.weakestArea.feedback}</div>
  1424	                    </div>
  1425	                </div>
  1426	
  1427	                <!-- Weekly Feedback -->
  1428	                <div class="bg-white border border-gray-200 rounded-lg p-6 mb-6">
  1429	                    <h4 class="text-xl font-semibold mb-4">ü§ñ Retroalimentaci√≥n Personalizada</h4>
  1430	                    <div class="space-y-4">
  1431	                        ${analysis.feedback.map(feedback => `
  1432	                            <div class="border-l-4 ${feedback.type === 'positive' ? 'border-green-400 bg-green-50' : feedback.type === 'improvement' ? 'border-yellow-400 bg-yellow-50' : 'border-blue-400 bg-blue-50'} p-4 rounded-r-lg">
  1433	                                <div class="font-medium ${feedback.type === 'positive' ? 'text-green-800' : feedback.type === 'improvement' ? 'text-yellow-800' : 'text-blue-800'}">${feedback.title}</div>
  1434	                                <div class="text-sm ${feedback.type === 'positive' ? 'text-green-700' : feedback.type === 'improvement' ? 'text-yellow-700' : 'text-blue-700'} mt-1">${feedback.message}</div>
  1435	                            </div>
  1436	                        `).join('')}
  1437	                    </div>
  1438	                </div>
  1439	
  1440	                <!-- Recommendations for Next Week -->
  1441	                <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-6">
  1442	                    <h4 class="text-xl font-semibold text-blue-800 mb-4">üöÄ Recomendaciones para la Pr√≥xima Semana</h4>
  1443	                    <ul class="space-y-2">
  1444	                        ${analysis.recommendations.map(rec => `
  1445	                            <li class="flex items-start">
  1446	                                <span class="text-blue-500 mr-2">‚Ä¢</span>
  1447	                                <span class="text-blue-700">${rec}</span>
  1448	                            </li>
  1449	                        `).join('')}
  1450	                    </ul>
  1451	                </div>
  1452	
  1453	                <!-- Reflections Summary -->
  1454	                ${analysis.reflections.length > 0 ? `
  1455	                <div class="bg-gray-50 border border-gray-200 rounded-lg p-6">
  1456	                    <h4 class="text-xl font-semibold mb-4">üìù Resumen de Reflexiones</h4>
  1457	                    <div class="space-y-3">
  1458	                        ${analysis.reflections.map((reflection, index) => `
  1459	                            <div class="bg-white p-3 rounded-lg border border-gray-100">
  1460	                                <div class="text-sm font-medium text-gray-600 mb-1">D√≠a ${index + 1}</div>
  1461	                                <div class="text-gray-800">"${reflection}"</div>
  1462	                            </div>
  1463	                        `).join('')}
  1464	                    </div>
  1465	                </div>
  1466	                ` : ''}
  1467	            `;
  1468	        }
  1469	
  1470	        function calculateWeeklyAnalysis(weekString) {
  1471	            const [year, week] = weekString.split('-W');
  1472	            const weekData = getWeekDataFromWeekString(weekString);
  1473	            
  1474	            // Calculate basic stats
  1475	            const totalPossibleHabits = gameData.habits.length * 7;
  1476	            const habitsCompleted = {
  1477	                completed: weekData.totalCompleted,
  1478	                total: totalPossibleHabits,
  1479	                percentage: totalPossibleHabits > 0 ? Math.round((weekData.totalCompleted / totalPossibleHabits) * 100) : 0
  1480	            };
  1481	
  1482	            // Calculate category performance
  1483	            const categoryScores = {};
  1484	            Object.keys(gameData.categories).forEach(catKey => {
  1485	                const catData = getCategoryWeekDataFromWeekString(catKey, weekString);
  1486	                categoryScores[catKey] = {
  1487	                    ...gameData.categories[catKey],
  1488	                    score: catData.percentage,
  1489	                    completed: catData.completed,
  1490	                    total: catData.total
  1491	                };
  1492	            });
  1493	
  1494	            // Find strongest and weakest areas
  1495	            const sortedCategories = Object.values(categoryScores).sort((a, b) => b.score - a.score);
  1496	            const strongestArea = sortedCategories[0] || { name: 'N/A', score: 0, feedback: 'A√±ade algunos h√°bitos para empezar.' };
  1497	            const weakestArea = sortedCategories[sortedCategories.length - 1] || { name: 'N/A', score: 0, feedback: 'A√±ade algunos h√°bitos para empezar.' };
  1498	
  1499	            // Generate personalized feedback
  1500	            const feedback = generatePersonalizedFeedback(weekData, categoryScores, habitsCompleted);
  1501	            
  1502	            // Generate recommendations
  1503	            const recommendations = generateRecommendations(weekData, categoryScores, habitsCompleted);
  1504	
  1505	            // Get reflections
  1506	            const reflections = getWeekReflections(weekString);
  1507	
  1508	            return {
  1509	                habitsCompleted,
  1510	                averageEnergy: weekData.avgEnergy,
  1511	                consistency: Math.round((weekData.trackingDays / 7) * 100),
  1512	                trackingDays: weekData.trackingDays,
  1513	                strongestArea: {
  1514	                    ...strongestArea,
  1515	                    feedback: generateAreaFeedback(strongestArea, 'strength')
  1516	                },
  1517	                weakestArea: {
  1518	                    ...weakestArea,
  1519	                    feedback: generateAreaFeedback(weakestArea, 'improvement')
  1520	                },
  1521	                feedback,
  1522	                recommendations,
  1523	                reflections
  1524	            };
  1525	        }
  1526	
  1527	        function getWeekDataFromWeekString(weekString) {
  1528	            const [year, week] = weekString.split('-W');
  1529	            const weekStart = getDateFromWeek(parseInt(year), parseInt(week));
  1530	            
  1531	            const weekData = {
  1532	                totalCompleted: 0,
  1533	                avgEnergy: 0,
  1534	                trackingDays: 0,
  1535	                dailyHabits: [0,0,0,0,0,0,0],
  1536	                dailyEnergy: [0,0,0,0,0,0,0]
  1537	            };
  1538	            
  1539	            let totalEnergy = 0;
  1540	            let energyDays = 0;
  1541	            
  1542	            for (let i = 0; i < 7; i++) {
  1543	                const date = new Date(weekStart);
  1544	                date.setDate(date.getDate() + i);
  1545	                const dateStr = date.toISOString().split('T')[0];
  1546	                const dayLog = gameData.dailyLogs[dateStr];
  1547	                
  1548	                if (dayLog) {
  1549	                    weekData.trackingDays++;
  1550	                    weekData.totalCompleted += dayLog.habits ? dayLog.habits.length : 0;
  1551	                    weekData.dailyHabits[i] = dayLog.habits ? dayLog.habits.length : 0;
  1552	                    
  1553	                    if (dayLog.energyLevel) {
  1554	                        totalEnergy += dayLog.energyLevel;
  1555	                        energyDays++;
  1556	                        weekData.dailyEnergy[i] = dayLog.energyLevel;
  1557	                    }
  1558	                }
  1559	            }
  1560	            
  1561	            weekData.avgEnergy = energyDays > 0 ? totalEnergy / energyDays : 0;
  1562	            return weekData;
  1563	        }
  1564	
  1565	        function getCategoryWeekDataFromWeekString(category, weekString) {
  1566	            const categoryHabits = gameData.habits.filter(h => h.category === category);
  1567	            const [year, week] = weekString.split('-W');
  1568	            const weekStart = getDateFromWeek(parseInt(year), parseInt(week));
  1569	            
  1570	            let completed = 0;
  1571	            let total = 0;
  1572	            
  1573	            for (let i = 0; i < 7; i++) {
  1574	                const date = new Date(weekStart);
  1575	                date.setDate(date.getDate() + i);
  1576	                const dateStr = date.toISOString().split('T')[0];
  1577	                const dayLog = gameData.dailyLogs[dateStr];
  1578	                
  1579	                total += categoryHabits.length;
  1580	                
  1581	                if (dayLog && dayLog.habits) {
  1582	                    categoryHabits.forEach(habit => {
  1583	                        if (dayLog.habits.includes(habit.id)) {
  1584	                            completed++;
  1585	                        }
  1586	                    });
  1587	                }
  1588	            }
  1589	            
  1590	            const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;
  1591	            return { completed, total, percentage };
  1592	        }
  1593	
  1594	        function getDateFromWeek(year, week) {
  1595	            const simple = new Date(year, 0, 1 + (week - 1) * 7);
  1596	            const dow = simple.getDay();
  1597	            const ISOweekStart = simple;
  1598	            if (dow <= 4)
  1599	                ISOweekStart.setDate(simple.getDate() - simple.getDay() + 1);
  1600	            else
  1601	                ISOweekStart.setDate(simple.getDate() + 8 - simple.getDay());
  1602	            return ISOweekStart;
  1603	        }
  1604	
  1605	        function generatePersonalizedFeedback(weekData, categoryScores, habitsCompleted) {
  1606	            const feedback = [];
  1607	            
  1608	            // Completion rate feedback
  1609	            if (habitsCompleted.percentage >= 80) {
  1610	                feedback.push({
  1611	                    type: 'positive',
  1612	                    title: '¬°Excelente semana!',
  1613	                    message: `Has completado el ${habitsCompleted.percentage}% de tus h√°bitos. ¬°Tu disciplina est√° siendo recompensada!`
  1614	                });
  1615	            } else if (habitsCompleted.percentage >= 60) {
  1616	                feedback.push({
  1617	                    type: 'improvement',
  1618	                    title: 'Buen progreso',
  1619	                    message: `Has completado el ${habitsCompleted.percentage}% de tus h√°bitos. Con un poco m√°s de constancia puedes llegar al siguiente nivel.`
  1620	                });
  1621	            } else {
  1622	                feedback.push({
  1623	                    type: 'improvement',
  1624	                    title: 'Oportunidad de mejora',
  1625	                    message: `Has completado el ${habitsCompleted.percentage}% de tus h√°bitos. Enf√≥cate en crear rutinas m√°s consistentes.`
  1626	                });
  1627	            }
  1628	
  1629	            // Energy level feedback
  1630	            if (weekData.avgEnergy >= 4) {
  1631	                feedback.push({
  1632	                    type: 'positive',
  1633	                    title: 'Energ√≠a extraordinaria',
  1634	                    message: 'Tu nivel de energ√≠a promedio ha sido excelente. ¬°Sigue aprovechando esa motivaci√≥n!'
  1635	                });
  1636	            } else if (weekData.avgEnergy >= 3) {
  1637	                feedback.push({
  1638	                    type: 'neutral',
  1639	                    title: 'Energ√≠a equilibrada',
  1640	                    message: 'Tu energ√≠a se mantiene en buen nivel. Identifica qu√© actividades te dan m√°s vitalidad.'
  1641	                });
  1642	            } else if (weekData.avgEnergy > 0) {
  1643	                feedback.push({
  1644	                    type: 'improvement',
  1645	                    title: 'Energ√≠a por mejorar',
  1646	                    message: 'Tu energ√≠a ha estado baja esta semana. Considera revisar tu descanso, alimentaci√≥n y ejercicio.'
  1647	                });
  1648	            }
  1649	
  1650	            // Consistency feedback
  1651	            if (weekData.trackingDays >= 6) {
  1652	                feedback.push({
  1653	                    type: 'positive',
  1654	                    title: 'Constancia admirable',
  1655	                    message: 'Has registrado tu progreso casi todos los d√≠as. Esta consistencia es clave para el √©xito.'
  1656	                });
  1657	            } else if (weekData.trackingDays >= 4) {
  1658	                feedback.push({
  1659	                    type: 'neutral',
  1660	                    title: 'Buen seguimiento',
  1661	                    message: 'Has mantenido un registro regular. Trata de completar todos los d√≠as para m√°ximo beneficio.'
  1662	                });
  1663	            } else {
  1664	                feedback.push({
  1665	                    type: 'improvement',
  1666	                    title: 'Mejora el seguimiento',
  1667	                    message: 'El registro diario es fundamental. Establece un recordatorio para no olvidar registrar tu progreso.'
  1668	                });
  1669	            }
  1670	
  1671	            return feedback;
  1672	        }
  1673	
  1674	        function generateRecommendations(weekData, categoryScores, habitsCompleted) {
  1675	            const recommendations = [];
  1676	            
  1677	            // Based on completion rate
  1678	            if (habitsCompleted.percentage < 70) {
  1679	                recommendations.push('Reduce la cantidad de h√°bitos y enf√≥cate en la consistencia antes que en la cantidad');
  1680	                recommendations.push('Establece recordatorios espec√≠ficos para tus h√°bitos m√°s importantes');
  1681	            }
  1682	
  1683	            // Based on energy levels
  1684	            if (weekData.avgEnergy < 3) {
  1685	                recommendations.push('Prioriza h√°bitos relacionados con descanso, ejercicio y alimentaci√≥n');
  1686	                recommendations.push('Considera revisar tu horario de sue√±o y niveles de estr√©s');
  1687	            }
  1688	
  1689	            // Based on tracking consistency
  1690	            if (weekData.trackingDays < 5) {
  1691	                recommendations.push('Establece una rutina fija para registrar tu progreso diario');
  1692	                recommendations.push('Usa notificaciones o alarmas como recordatorio');
  1693	            }
  1694	
  1695	            // Category-specific recommendations
  1696	            const sortedCategories = Object.values(categoryScores).sort((a, b) => a.score - b.score);
  1697	            if (sortedCategories.length > 0) {
  1698	                const weakest = sortedCategories[0];
  1699	                if (weakest.score < 50) {
  1700	                    recommendations.push(`Enf√≥cate especialmente en mejorar h√°bitos de ${weakest.name} la pr√≥xima semana`);
  1701	                }
  1702	            }
  1703	
  1704	            // General recommendations
  1705	            recommendations.push('Celebra tus peque√±os logros diarios para mantener la motivaci√≥n');
  1706	            recommendations.push('Revisa y ajusta metas que sean muy ambiciosas o muy f√°ciles');
  1707	
  1708	            return recommendations.slice(0, 4); // Limit to 4 recommendations
  1709	        }
  1710	
  1711	        function generateAreaFeedback(area, type) {
  1712	            if (type === 'strength') {
  1713	                if (area.score >= 80) return '¬°Excepcional! Mant√©n este excelente nivel de constancia.';
  1714	                if (area.score >= 60) return 'Muy bien. Esta √°rea est√° siendo tu fuerte.';
  1715	                return '√Årea s√≥lida que puedes usar como base para mejorar otras.';
  1716	            } else {
  1717	                if (area.score < 30) return '√Årea que necesita atenci√≥n prioritaria. Empieza con h√°bitos peque√±os y espec√≠ficos.';
  1718	                if (area.score < 60) return 'Con un poco m√°s de enfoque puedes mejorar significativamente aqu√≠.';
  1719	                return '√Årea con buen potencial de mejora. Peque√±os ajustes pueden hacer gran diferencia.';
  1720	            }
  1721	        }
  1722	
  1723	        function getWeekReflections(weekString) {
  1724	            const [year, week] = weekString.split('-W');
  1725	            const weekStart = getDateFromWeek(parseInt(year), parseInt(week));
  1726	            const reflections = [];
  1727	            
  1728	            for (let i = 0; i < 7; i++) {
  1729	                const date = new Date(weekStart);
  1730	                date.setDate(date.getDate() + i);
  1731	                const dateStr = date.toISOString().split('T')[0];
  1732	                const dayLog = gameData.dailyLogs[dateStr];
  1733	                
  1734	                if (dayLog && dayLog.reflection && dayLog.reflection.trim()) {
  1735	                    reflections.push(dayLog.reflection.trim());
  1736	                }
  1737	            }
  1738	            
  1739	            return reflections;
  1740	        }
  1741	
  1742	        function getEnergyDescription(energy) {
  1743	            if (energy >= 4.5) return 'Extraordinario';
  1744	            if (energy >= 3.5) return 'Muy bueno';
  1745	            if (energy >= 2.5) return 'Promedio';
  1746	            if (energy >= 1.5) return 'Bajo';
  1747	            return 'Muy bajo';
  1748	        }
  1749	
  1750	        // Gamification Extended Functions
  1751	        function updateStreaks() {
  1752	            const today = new Date().toISOString().split('T')[0];
  1753	            const yesterday = new Date();
  1754	            yesterday.setDate(yesterday.getDate() - 1);
  1755	            const yesterdayStr = yesterday.toISOString().split('T')[0];
  1756	            
  1757	            // Update category streaks
  1758	            Object.keys(gameData.categories).forEach(catKey => {
  1759	                const categoryHabits = gameData.habits.filter(h => h.category === catKey);
  1760	                const todayLog = gameData.dailyLogs[today];
  1761	                const yesterdayLog = gameData.dailyLogs[yesterdayStr];
  1762	                
  1763	                if (categoryHabits.length === 0) {
  1764	                    gameData.streaks[catKey] = 0;
  1765	                    return;
  1766	                }
  1767	                
  1768	                // Check if all category habits completed today
  1769	                const todayCompleted = todayLog && todayLog.habits ? 
  1770	                    categoryHabits.every(habit => todayLog.habits.includes(habit.id)) : false;
  1771	                
  1772	                const yesterdayCompleted = yesterdayLog && yesterdayLog.habits ? 
  1773	                    categoryHabits.every(habit => yesterdayLog.habits.includes(habit.id)) : false;
  1774	                
  1775	                if (todayCompleted) {
  1776	                    if (yesterdayCompleted || gameData.streaks[catKey] === 0) {
  1777	                        gameData.streaks[catKey] = (gameData.streaks[catKey] || 0) + 1;
  1778	                    } else {
  1779	                        gameData.streaks[catKey] = 1;
  1780	                    }
  1781	                } else {
  1782	                    gameData.streaks[catKey] = 0;
  1783	                }
  1784	            });
  1785	        }
  1786	
  1787	        function checkAchievements() {
  1788	            const achievements = gameData.achievements;
  1789	            const newBadges = [];
  1790	            
  1791	            // First Habit
  1792	            if (!achievements.firstHabit && gameData.habits.length >= 1) {
  1793	                achievements.firstHabit = true;
  1794	                newBadges.push({ id: 'first_habit', name: 'Primer Paso', icon: 'üå±', description: 'Creaste tu primer h√°bito' });
  1795	            }
  1796	            
  1797	            // Week Warrior (complete 7 days of tracking)
  1798	            const trackingDays = Object.keys(gameData.dailyLogs).length;
  1799	            if (!achievements.weekWarrior && trackingDays >= 7) {
  1800	                achievements.weekWarrior = true;
  1801	                newBadges.push({ id: 'week_warrior', name: 'Guerrero Semanal', icon: '‚öîÔ∏è', description: 'Completaste 7 d√≠as de seguimiento' });
  1802	            }
  1803	            
  1804	            // Energy Master (5 consecutive days with energy >= 4)
  1805	            if (!achievements.energyMaster) {
  1806	                const recentDays = getLastNDays(5);
  1807	                const highEnergyDays = recentDays.filter(day => {
  1808	                    const log = gameData.dailyLogs[day];
  1809	                    return log && log.energyLevel >= 4;
  1810	                });
  1811	                if (highEnergyDays.length >= 5) {
  1812	                    achievements.energyMaster = true;
  1813	                    newBadges.push({ id: 'energy_master', name: 'Maestro de Energ√≠a', icon: '‚ö°', description: '5 d√≠as consecutivos con energ√≠a alta' });
  1814	                }
  1815	            }
  1816	            
  1817	            // Perfect Week (100% habits completion for a week)
  1818	            if (!achievements.perfectWeek) {
  1819	                const weekData = getWeekData();
  1820	                if (weekData.trackingDays >= 7) {
  1821	                    const totalPossible = gameData.habits.length * 7;
  1822	                    if (totalPossible > 0 && weekData.totalCompleted >= totalPossible) {
  1823	                        achievements.perfectWeek = true;
  1824	                        newBadges.push({ id: 'perfect_week', name: 'Semana Perfecta', icon: 'üëë', description: 'Completaste todos tus h√°bitos por una semana' });
  1825	                    }
  1826	                }
  1827	            }
  1828	            
  1829	            // Streak Master (15 day streak in any category)
  1830	            if (!achievements.streakMaster) {
  1831	                const maxStreak = Math.max(...Object.values(gameData.streaks));
  1832	                if (maxStreak >= 15) {
  1833	                    achievements.streakMaster = true;
  1834	                    newBadges.push({ id: 'streak_master', name: 'Maestro de Rachas', icon: 'üî•', description: '15 d√≠as de racha en una categor√≠a' });
  1835	                }
  1836	            }
  1837	            
  1838	            // Chronicler (write 10 reflections)
  1839	            if (!achievements.chronicler) {
  1840	                const reflectionCount = Object.values(gameData.dailyLogs).filter(log => log.reflection && log.reflection.trim()).length;
  1841	                if (reflectionCount >= 10) {
  1842	                    achievements.chronicler = true;
  1843	                    newBadges.push({ id: 'chronicler', name: 'Cronista', icon: 'üìñ', description: 'Escribiste 10 reflexiones' });
  1844	                }
  1845	            }
  1846	            
  1847	            // Evolution (reach level 3)
  1848	            if (!achievements.evolution && gameData.player.level >= 3) {
  1849	                achievements.evolution = true;
  1850	                newBadges.push({ id: 'evolution', name: 'Evoluci√≥n', icon: 'üåü', description: 'Alcanzaste el nivel 3' });
  1851	            }
  1852	            
  1853	            // Coin Collector (earn 500 coins)
  1854	            if (!achievements.coinCollector && gameData.player.coins >= 500) {
  1855	                achievements.coinCollector = true;
  1856	                newBadges.push({ id: 'coin_collector', name: 'Colector de Monedas', icon: 'üí∞', description: 'Acumulaste 500 monedas' });
  1857	            }
  1858	            
  1859	            // Add new badges to collection
  1860	            newBadges.forEach(badge => {
  1861	                if (!gameData.badges.find(b => b.id === badge.id)) {
  1862	                    gameData.badges.push(badge);
  1863	                    showNotification(`¬°Nueva insignia desbloqueada: ${badge.name}!`, 'success');
  1864	                    gameData.player.coins += 25; // Bonus for earning badge
  1865	                }
  1866	            });
  1867	        }
  1868	
  1869	        function getLastNDays(n) {
  1870	            const days = [];
  1871	            const today = new Date();
  1872	            for (let i = 0; i < n; i++) {
  1873	                const date = new Date(today);
  1874	                date.setDate(date.getDate() - i);
  1875	                days.push(date.toISOString().split('T')[0]);
  1876	            }
  1877	            return days.reverse();
  1878	        }
  1879	
  1880	        function updateBadgesDisplay(container) {
  1881	            if (gameData.badges.length === 0) {
  1882	                container.innerHTML = '<p class="col-span-full text-gray-500 text-center">Las insignias se desbloquear√°n conforme completes objetivos especiales.</p>';
  1883	                return;
  1884	            }
  1885	            
  1886	            container.innerHTML = gameData.badges.map(badge => `
  1887	                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 text-center">
  1888	                    <div class="text-2xl mb-1">${badge.icon}</div>
  1889	                    <div class="font-semibold text-sm text-yellow-800">${badge.name}</div>
  1890	                    <div class="text-xs text-yellow-600">${badge.description}</div>
  1891	                </div>
  1892	            `).join('');
  1893	        }
  1894	
  1895	        function updateStreaksDisplay() {
  1896	            const container = document.getElementById('streaks-display');
  1897	            container.innerHTML = '';
  1898	            
  1899	            Object.keys(gameData.categories).forEach(catKey => {
  1900	                const category = gameData.categories[catKey];
  1901	                const streak = gameData.streaks[catKey] || 0;
  1902	                const streakLevel = getStreakLevel(streak);
  1903	                
  1904	                const streakElement = document.createElement('div');
  1905	                streakElement.className = `p-4 rounded-lg border-2 ${streakLevel.borderColor} ${streakLevel.bgColor}`;
  1906	                streakElement.innerHTML = `
  1907	                    <div class="text-center">
  1908	                        <div class="text-3xl mb-2">${category.icon}</div>
  1909	                        <div class="font-semibold text-sm ${streakLevel.textColor}">${category.name}</div>
  1910	                        <div class="text-2xl font-bold ${streakLevel.textColor} mt-1">${streak}</div>
  1911	                        <div class="text-xs ${streakLevel.textColor}">d√≠as seguidos</div>
  1912	                        ${streak >= 7 ? '<div class="text-lg mt-1">üî•</div>' : ''}
  1913	                        ${streak >= 30 ? '<div class="text-lg">üíé</div>' : ''}
  1914	                    </div>
  1915	                `;
  1916	                container.appendChild(streakElement);
  1917	            });
  1918	        }
  1919	
  1920	        function getStreakLevel(streak) {
  1921	            if (streak >= 30) {
  1922	                return {
  1923	                    bgColor: 'bg-purple-50',
  1924	                    borderColor: 'border-purple-400',
  1925	                    textColor: 'text-purple-800'
  1926	                };
  1927	            } else if (streak >= 14) {
  1928	                return {
  1929	                    bgColor: 'bg-yellow-50',
  1930	                    borderColor: 'border-yellow-400',
  1931	                    textColor: 'text-yellow-800'
  1932	                };
  1933	            } else if (streak >= 7) {
  1934	                return {
  1935	                    bgColor: 'bg-orange-50',
  1936	                    borderColor: 'border-orange-400',
  1937	                    textColor: 'text-orange-800'
  1938	                };
  1939	            } else if (streak >= 3) {
  1940	                return {
  1941	                    bgColor: 'bg-green-50',
  1942	                    borderColor: 'border-green-400',
  1943	                    textColor: 'text-green-800'
  1944	                };
  1945	            } else {
  1946	                return {
  1947	                    bgColor: 'bg-gray-50',
  1948	                    borderColor: 'border-gray-300',
  1949	                    textColor: 'text-gray-600'
  1950	                };
  1951	            }
  1952	        }
  1953	
  1954	        function updateShopTab() {
  1955	            const container = document.getElementById('shop-items');
  1956	            container.innerHTML = '';
  1957	            
  1958	            gameData.shopItems.forEach(item => {
  1959	                const canAfford = gameData.player.coins >= item.cost;
  1960	                const itemElement = document.createElement('div');
  1961	                itemElement.className = `bg-gray-50 rounded-lg p-4 border ${canAfford ? 'border-green-300' : 'border-gray-200'}`;
  1962	                itemElement.innerHTML = `
  1963	                    <div class="text-center">
  1964	                        <div class="text-4xl mb-2">${item.icon}</div>
  1965	                        <h3 class="font-semibold mb-2">${item.name}</h3>
  1966	                        <div class="text-lg font-bold text-yellow-600 mb-3">ü™ô ${item.cost}</div>
  1967	                        <button onclick="buyItem(${item.id})" ${!canAfford ? 'disabled' : ''} 
  1968	                                class="${canAfford ? 'bg-green-600 hover:bg-green-700' : 'bg-gray-400'} text-white px-4 py-2 rounded-lg transition-colors">
  1969	                            ${canAfford ? 'Comprar' : 'Sin fondos'}
  1970	                        </button>
  1971	                    </div>
  1972	                `;
  1973	                container.appendChild(itemElement);
  1974	            });
  1975	        }
  1976	
  1977	        function buyItem(itemId) {
  1978	            const item = gameData.shopItems.find(i => i.id === itemId);
  1979	            if (!item) return;
  1980	            
  1981	            if (gameData.player.coins >= item.cost) {
  1982	                gameData.player.coins -= item.cost;
  1983	                saveGameData();
  1984	                updatePlayerStats();
  1985	                updateShopTab();
  1986	                showNotification(`¬°Has comprado ${item.name}! ¬°Disfr√∫talo sin culpa!`, 'success');
  1987	            } else {
  1988	                showNotification('No tienes suficientes monedas', 'warning');
  1989	            }
  1990	        }
  1991	
  1992	        function updateProfileTab() {
  1993	            // Update profile wolf avatar image
  1994	            const profileWolfImage = document.getElementById('profile-wolf-avatar-image');
  1995	            if (profileWolfImage) {
  1996	                profileWolfImage.className = `wolf-profile-image level-${gameData.player.level}`;
  1997	            }
  1998	            
  1999	            document.getElementById('profile-wolf-name').textContent = gameData.player.name;
  2000	            document.getElementById('profile-wolf-level').textContent = gameData.player.level;
  2001	            
  2002	            // Update description
  2003	            const currentEvolution = gameData.wolfEvolution.find(evo => evo.level === gameData.player.level);
  2004	            const descElement = document.getElementById('profile-wolf-description');
  2005	            if (descElement && currentEvolution) {
  2006	                descElement.textContent = currentEvolution.description;
  2007	            }
  2008	            
  2009	            // Evolution path
  2010	            const evolutionContainer = document.getElementById('evolution-path');
  2011	            evolutionContainer.innerHTML = '';
  2012	            
  2013	            gameData.wolfEvolution.forEach((evolution, index) => {
  2014	                const isUnlocked = gameData.player.xp >= evolution.minXp;
  2015	                const isCurrent = gameData.player.level === evolution.level;
  2016	                
  2017	                const evolutionElement = document.createElement('div');
  2018	                evolutionElement.className = `text-center p-4 rounded-lg ${isCurrent ? 'bg-blue-100 border-2 border-blue-500' : isUnlocked ? 'bg-green-50' : 'bg-gray-100'}`;
  2019	                evolutionElement.innerHTML = `
  2020	                    <div class="wolf-evolution-image level-${evolution.level} ${isUnlocked ? '' : 'grayscale opacity-50'} mx-auto mb-2"></div>
  2021	                    <div class="font-medium text-sm">${evolution.name}</div>
  2022	                    <div class="text-xs text-gray-600">Nivel ${evolution.level}</div>
  2023	                    <div class="text-xs text-gray-500 mt-1">${evolution.description}</div>
  2024	                    ${isCurrent ? '<div class="badge mt-2">Actual</div>' : ''}
  2025	                `;
  2026	                evolutionContainer.appendChild(evolutionElement);
  2027	            });
  2028	            
  2029	            // Badges
  2030	            const badgesContainer = document.getElementById('badges-container');
  2031	            updateBadgesDisplay(badgesContainer);
  2032	            
  2033	            // Profile stats
  2034	            const statsContainer = document.getElementById('profile-stats');
  2035	            const totalDays = Object.keys(gameData.dailyLogs).length;
  2036	            const totalHabitsCompleted = Object.values(gameData.dailyLogs).reduce((sum, log) => sum + (log.habits ? log.habits.length : 0), 0);
  2037	            
  2038	            statsContainer.innerHTML = `
  2039	                <div class="bg-blue-50 p-3 rounded-lg text-center">
  2040	                    <div class="text-2xl font-bold text-blue-600">${totalDays}</div>
  2041	                    <div class="text-sm text-blue-800">D√≠as registrados</div>
  2042	                </div>
  2043	                <div class="bg-green-50 p-3 rounded-lg text-center">
  2044	                    <div class="text-2xl font-bold text-green-600">${totalHabitsCompleted}</div>
  2045	                    <div class="text-sm text-green-800">H√°bitos completados</div>
  2046	                </div>
  2047	                <div class="bg-yellow-50 p-3 rounded-lg text-center">
  2048	                    <div class="text-2xl font-bold text-yellow-600">${gameData.player.coins}</div>
  2049	                    <div class="text-sm text-yellow-800">Monedas ganadas</div>
  2050	                </div>
  2051	                <div class="bg-purple-50 p-3 rounded-lg text-center">
  2052	                    <div class="text-2xl font-bold text-purple-600">${gameData.player.xp}</div>
  2053	                    <div class="text-sm text-purple-800">XP total</div>
  2054	                </div>
  2055	            `;
  2056	        }
  2057	    </script>
  2058	</body>
  2059	</html>